<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Lazy Load (IntersectionObserver)</title>
    <style>
      img {
        width: 300px;
        height: 300px;
        display: block;
        margin: 20px auto;
      }
    </style>
    <script
      src="https://cdn.jsdelivr.net/npm/color-thief-browser@2.0.2/dist/color-thief.min.js"
      integrity="sha256-pwYHMCkefjudHMlFinD6kK0ITZMjli6PoOQHwvm7M/M="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <img
      data-src="https://images.unsplash.com/photo-1652899728939-1a5a41fbf2c0?ixlib=rb-1.2.1&raw_url=true&q=60&fm=jpg&crop=entropy&cs=tinysrgb&ixid=MnwxMjA3fDB8MHx0b3BpYy1mZWVkfDJ8Ym84alFLVGFFMFl8fGVufDB8fHx8&auto=format&fit=crop&w=600"
    /><img
      data-src="https://images.unsplash.com/photo-1652637638621-78ff50468dd7?ixlib=rb-1.2.1&raw_url=true&q=60&fm=jpg&crop=entropy&cs=tinysrgb&ixid=MnwxMjA3fDB8MHx0b3BpYy1mZWVkfDN8Ym84alFLVGFFMFl8fGVufDB8fHx8&auto=format&fit=crop&w=600"
    /><img
      data-src="https://images.unsplash.com/photo-1652981989876-ea9a9cb5a1ac?crop=entropy&cs=tinysrgb&fm=jpg&ixlib=rb-1.2.1&q=60&raw_url=true&ixid=MnwxMjA3fDB8MHx0b3BpYy1mZWVkfDV8Ym84alFLVGFFMFl8fGVufDB8fHx8&auto=format&fit=crop&w=600"
    />
    <img
      data-src="https://images.unsplash.com/photo-1652899728939-1a5a41fbf2c0?ixlib=rb-1.2.1&raw_url=true&q=60&fm=jpg&crop=entropy&cs=tinysrgb&ixid=MnwxMjA3fDB8MHx0b3BpYy1mZWVkfDJ8Ym84alFLVGFFMFl8fGVufDB8fHx8&auto=format&fit=crop&w=600"
    /><img
      data-src="https://images.unsplash.com/photo-1652637638621-78ff50468dd7?ixlib=rb-1.2.1&raw_url=true&q=60&fm=jpg&crop=entropy&cs=tinysrgb&ixid=MnwxMjA3fDB8MHx0b3BpYy1mZWVkfDN8Ym84alFLVGFFMFl8fGVufDB8fHx8&auto=format&fit=crop&w=600"
    /><img
      data-src="https://images.unsplash.com/photo-1652981989876-ea9a9cb5a1ac?crop=entropy&cs=tinysrgb&fm=jpg&ixlib=rb-1.2.1&q=60&raw_url=true&ixid=MnwxMjA3fDB8MHx0b3BpYy1mZWVkfDV8Ym84alFLVGFFMFl8fGVufDB8fHx8&auto=format&fit=crop&w=600"
    />
    <img
      data-src="https://images.unsplash.com/photo-1652899728939-1a5a41fbf2c0?ixlib=rb-1.2.1&raw_url=true&q=60&fm=jpg&crop=entropy&cs=tinysrgb&ixid=MnwxMjA3fDB8MHx0b3BpYy1mZWVkfDJ8Ym84alFLVGFFMFl8fGVufDB8fHx8&auto=format&fit=crop&w=600"
    /><img
      data-src="https://images.unsplash.com/photo-1652637638621-78ff50468dd7?ixlib=rb-1.2.1&raw_url=true&q=60&fm=jpg&crop=entropy&cs=tinysrgb&ixid=MnwxMjA3fDB8MHx0b3BpYy1mZWVkfDN8Ym84alFLVGFFMFl8fGVufDB8fHx8&auto=format&fit=crop&w=600"
    /><img
      data-src="https://images.unsplash.com/photo-1652981989876-ea9a9cb5a1ac?crop=entropy&cs=tinysrgb&fm=jpg&ixlib=rb-1.2.1&q=60&raw_url=true&ixid=MnwxMjA3fDB8MHx0b3BpYy1mZWVkfDV8Ym84alFLVGFFMFl8fGVufDB8fHx8&auto=format&fit=crop&w=600"
    />

    <script>
      const colorThief = new ColorThief();

      function observe() {
        const imgs = document.querySelectorAll("img");

        let observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((item) => {
              if (item.isIntersecting) {
                const image = new Image();

                image.addEventListener("load", function () {
                  const colorArray = colorThief.getColor(image);
                  item.target.style.backgroundColor = `rgba(${colorArray[0]}, ${colorArray[1]}, ${colorArray[2]})`;
                });

                image.crossOrigin = "Anonymous";
                image.src = item.target.dataset.src;

                setTimeout(() => {
                  item.target.src = item.target.dataset.src;
                  observer.unobserve(item.target);
                }, 1000);
              }
            });
          },
          {
            rootMargin: "0px 0px -100px 0px",
          }
        );

        imgs.forEach((item) => observer.observe(item));
      }

      observe();
    </script>
  </body>
</html>
